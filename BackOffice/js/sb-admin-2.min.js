

function CriarCampos() {
  window.location.href = "CriarCampo.html";
}

function Campos() {
  window.location.href = "Campos.html";
}


function CriarProfissional() {
  window.location.href = "CriarProfissional.html";
}

function ApagarCampo() {
  if (typeof localStorage !== 'undefined') {
    var items = JSON.parse(localStorage.getItem('Campos'));
    const inputNome = document.querySelector("#input-fundo");
    const nomeRemover = inputNome.value;
    var itemIndex = items.findIndex(item => item.Nome === nomeRemover);
    if (itemIndex !== -1) {
      items.splice(itemIndex, 1);
      localStorage.setItem('Campos', JSON.stringify(items));

      console.log('O item  foi removido do LocalStorage.');
    } else {
      console.log('O item não foi encontrado no LocalStorage.');
    }
  } else {
    console.log('O LocalStorage não está disponível no navegador.');
  }
  window.location.href = "Campos.html";
}

function ApagarPro() {
  if (typeof localStorage !== 'undefined') {
    var items = JSON.parse(localStorage.getItem('Profissionais'));
    var users = JSON.parse(localStorage.getItem('Utilizadores'));
    const inputNome = document.querySelector("#input-Nome");
    const nomeRemover = inputNome.value;
    var itemIndex = items.findIndex(item => item.Nome === nomeRemover);
    var UserIndex = users.findIndex(user => user.Nome === items[itemIndex].Username);
    if (itemIndex !== -1) {
      items.splice(itemIndex, 1);
      localStorage.setItem('Profissionais', JSON.stringify(items));

      console.log('O item  foi removido do LocalStorage.');
    } else {
      console.log('O item não foi encontrado no LocalStorage.');
      return;
    }

    if (UserIndex !== -1) {
      users.splice(UserIndex, 1);
      localStorage.setItem('Utilizadores', JSON.stringify(users));
    }
  } else {
    console.log('O LocalStorage não está disponível no navegador.');
  }

  window.location.href = "Profissionais.html";
}

function RegistarAlteraçõesPro() {
  if (typeof localStorage !== 'undefined') {
    var items = JSON.parse(localStorage.getItem('Profissionais'));
    const inputNome = document.querySelector("#input-Nome");
    const inputNaturalidade = document.querySelector("#input-Naturalidade");
    const inputNascimento = document.querySelector("#input-Nascimento");
    const SelectCampos2 = document.querySelector("#SelectCampos2");
    const inputEmail = document.querySelector("#input-Email");
    const inputContacto = document.querySelector("#input-Contacto");
    const data = sessionStorage.getItem('ProEscolhido');
    const dados = JSON.parse(data);
    const nomeAlterar = dados.Nome;
    let valor = "";
    var itemIndex = items.findIndex(item => item.Nome === nomeAlterar);
    if (itemIndex !== -1) {
      items[itemIndex].Nome = inputNome.value;
      items[itemIndex].Naturalidade = inputNaturalidade.value;
      items[itemIndex].Dob = inputNascimento.value;
      items[itemIndex].Campo = SelectCampos2.value;
      items[itemIndex].Email = inputEmail.value;
      items[itemIndex].Contacto = inputContacto.value;
      localStorage.setItem('Profissionais', JSON.stringify(items));

      console.log('O item  foi alterado.');
    } else {
      console.log('O item não foi alterado.');
    }
  } else {
    console.log('O LocalStorage não está disponível no navegador.');
  }
  window.location.href = "Profissionais.html";
}

function RegistarAlteraçõesCampo() {
  if (typeof localStorage !== 'undefined') {
    const imagem = sessionStorage.getItem("Imagem");
    var items = JSON.parse(localStorage.getItem('Campos'));
    const inputNome = document.querySelector("#input-fundo");
    const inputlocalizacao = document.querySelector("#input-localizacao");
    const inputbalnearios = document.querySelector("#input-balnearios");
    const inputrelvado = document.querySelector("#input-relvado");
    const inputOutros = document.querySelector("#input-Outros");
    const inputPreco = document.querySelector("#input-Preco");
    const inputbola = document.querySelector("#input-bola");
    const inputcoletes = document.querySelector("#input-coletes");
    const data = sessionStorage.getItem('CampoEscolhido');
    const dados = JSON.parse(data);
    const nomeAlterar = dados.Nome;
    let valor = "";
    var itemIndex = items.findIndex(item => item.Nome === nomeAlterar);
    if (itemIndex !== -1) {
      items[itemIndex].Nome = inputNome.value;
      items[itemIndex].Imagem = imagem;
      items[itemIndex].Localizacao = inputlocalizacao.value;
      items[itemIndex].Balnearios = inputbalnearios.value;
      items[itemIndex].Relvado = inputrelvado.value;
      items[itemIndex].Outros = inputOutros.value;
      items[itemIndex].Preco = inputPreco.value;
      items[itemIndex].Bola = inputbola.value;
      items[itemIndex].Coletes = inputcoletes.value;
      localStorage.setItem('Campos', JSON.stringify(items));

      console.log('O item  foi alterado.');
    } else {
      console.log('O item não foi alterado.');
    }
  } else {
    console.log('O LocalStorage não está disponível no navegador.');
  }
  window.location.href = "Profissionais.html";
}

function RegistarProfissional(event) {
  event.preventDefault();
  const inputNome = document.querySelector("#input-Nome");
  const inputUser = document.querySelector("#input-User");
  const inputPass = document.querySelector("#input-Pass");
  const inputs = document.querySelectorAll('.inputsPro');
  const imagem = sessionStorage.getItem("Imagem");
  let data = {};
  let data2 = {};
  if (inputPass.value == null || inputPass.value == "") {
    alert('Por favor insira o  Username.');
    return;
  }
  if (inputUser.value == null || inputUser.value == "") {
    alert('Por favor insira a Password.');
    return;
  }
  if (inputNome.value == null || inputNome.value == "") {
    alert('Por favor insira o nome.');
  } else {
    data[inputNome.name] = inputNome.value;
    for (const element of inputs) {
      if (element.value == null || element.value == "") {
        alert('Preencha os campos vazios');
        return;
      }
      data[element.name] = element.value;
    }
    data["Imagem"] = imagem;
    data["Username"] = inputUser.value;
    SaveDataToLocalStorageProfissionais(data);
    data2["Username"] = inputUser.value;
    data2["Email"] = "";
    data2["Password"] = inputPass.value;
    data2["Contacto"] = "";
    data2["Imagem"] = "";
    data2["NIF"] = "";
    data2["Nome"] = "";
    data2["Tipo"] = "Profissional"
    a = JSON.parse(localStorage.getItem("Utilizadores")) || [];
    a.push(data2);
    localStorage.setItem("Utilizadores", JSON.stringify(a));
    window.location.href = "Profissionais.html";
  }

}

function SaveDataToLocalStorageProfissionais(data) {
  let a = [];
  a = JSON.parse(localStorage.getItem("Profissionais")) || [];
  a.push(data);
  localStorage.setItem("Profissionais", JSON.stringify(a));
}

function RegistarCampos(event) {
  event.preventDefault();
  const inputs = document.querySelectorAll('.inputs');
  const imagem = sessionStorage.getItem("Imagem");
  let data = {};
  for (const element of inputs) {
    if (element.value == null || element.value == "" && element.name != "Outros") {
      alert('Preencha os campos vazios');
      return;
    }
    data[element.name] = element.value;
  }
  data["Imagem"] = imagem;
  console.log(data);
  SaveDataToLocalStorageCampos(data);
  window.location.href = "Campos.html";

}

function SaveDataToLocalStorageCampos(data) {
  let a = [];
  a = JSON.parse(localStorage.getItem("Campos")) || [];
  a.push(data);
  localStorage.setItem("Campos", JSON.stringify(a));
}

/*
function CriarTabelaPros() {
  let data = JSON.parse(localStorage.getItem("Profissionais"))
  console.log(data)
  let tableData = data.map(user => (
    `
  <tr>
  <td><a href="ConsulatarProfissionais.html">${user.Nome}</a></td>
  <td>${user.Contacto}</td>
  <td>${user.Email}</td>
  <td>${user.Naturalidade}</td>
  </tr>
  `
  )).join('');
  let tbody = document.querySelector('#TabelaPros');
  tbody.innerHTML = tableData;
}*/



!function (l) { "use strict"; l("#sidebarToggle, #sidebarToggleTop").on("click", function (e) { l("body").toggleClass("sidebar-toggled"), l(".sidebar").toggleClass("toggled"), l(".sidebar").hasClass("toggled") && l(".sidebar .collapse").collapse("hide") }), l(window).resize(function () { l(window).width() < 768 && l(".sidebar .collapse").collapse("hide"), l(window).width() < 480 && !l(".sidebar").hasClass("toggled") && (l("body").addClass("sidebar-toggled"), l(".sidebar").addClass("toggled"), l(".sidebar .collapse").collapse("hide")) }), l("body.fixed-nav .sidebar").on("mousewheel DOMMouseScroll wheel", function (e) { var o; 768 < l(window).width() && (o = (o = e.originalEvent).wheelDelta || -o.detail, this.scrollTop += 30 * (o < 0 ? 1 : -1), e.preventDefault()) }), l(document).on("scroll", function () { 100 < l(this).scrollTop() ? l(".scroll-to-top").fadeIn() : l(".scroll-to-top").fadeOut() }), l(document).on("click", "a.scroll-to-top", function (e) { var o = l(this); l("html, body").stop().animate({ scrollTop: l(o.attr("href")).offset().top }, 1e3, "easeInOutExpo"), e.preventDefault() }) }(jQuery);





function previewImagem(event) {
  const label = document.getElementById("labelImagem");
  const input = event.target;
  const quadrado = document.getElementById("quadrado-inserir-imagem");
  const imagem = input.files[0];
  const reader = new FileReader();
  reader.readAsDataURL(imagem);
  reader.onload = function () {
    quadrado.style.backgroundImage = `url(${reader.result})`;
    const estilo = quadrado.style.backgroundImage;
    quadrado.style.backgroundSize = 'cover';
    quadrado.style.backgroundPosition = 'center';
    quadrado.style.backgroundRepeat = 'no-repeat';
    label.textContent = "";
    sessionStorage.setItem("Imagem", estilo);
  };
}

function previewImagem2(event) {
  const label = document.getElementById("labelImagem");
  const input = event.target;
  const quadrado = document.getElementById("quadrado-inserir-imagem_Pro");
  const imagem = input.files[0];
  const reader = new FileReader();
  reader.readAsDataURL(imagem);
  reader.onload = function () {
    quadrado.style.backgroundImage = `url(${reader.result})`;
    const estilo = quadrado.style.backgroundImage;
    quadrado.style.backgroundSize = 'cover';
    quadrado.style.backgroundPosition = 'center';
    quadrado.style.backgroundRepeat = 'no-repeat';
    label.textContent = "";
    sessionStorage.setItem("Imagem", estilo);
  }

};


function MostarImagem() {
  const user = JSON.parse(sessionStorage.getItem('UtilizadorLigado'));
  document.getElementById("NomePerf").innerHTML = user.Nome;
  const Campos = JSON.parse(localStorage.getItem('Campos'));
  const quadrado = document.getElementById("quadrado-inserir-imagem");
  if (Campos && Campos.length > 0) {
    Campos.forEach(function (profissional) {
      quadrado.style.backgroundImage = profissional.Imagem;
      quadrado.style.backgroundSize = 'cover';
      quadrado.style.backgroundPosition = 'center';
      quadrado.style.backgroundRepeat = 'no-repeat';
    });

  } else {
    console.error('Lista de profissionais não encontrada no localStorage ou vazia');
  }
}

const nCampos = new Vue({
  el: '#nCampos',
  data: {
    nCampos: 0,
  },
  mounted() {
    const data = localStorage.getItem('Campos');
    if (data) {
      const parsedData = JSON.parse(data);
      this.nCampos = parsedData.length;
    }
  }
});

const nPros = new Vue({
  el: '#nPros',
  data: {
    nPros: 0,
  },
  mounted() {
    const data = localStorage.getItem('Profissionais');
    if (data) {
      const parsedData = JSON.parse(data);
      this.nPros = parsedData.length;
    }
  }
});

const app = new Vue({
  el: '#tabelaPros',
  data: {
    items: []
  },
  mounted() {
    const data = localStorage.getItem('Profissionais');
    if (data) {
      const parsedData = JSON.parse(data);
      this.items = parsedData;
    }
  },
  methods: {
    verProfissional(item) {
      sessionStorage.setItem("ProEscolhido", JSON.stringify(item));
      window.location.href = "ConsulatarProfissionais.html";
    },
  },
});


const tabelaCampos = new Vue({
  el: '#tabelaCampos',
  data: {
    items: []
  },
  mounted() {
    const data = localStorage.getItem('Campos');
    if (data) {
      const parsedData = JSON.parse(data);
      this.items = parsedData;
    }
  },
  methods: {
    verCampo(item) {
      sessionStorage.setItem("CampoEscolhido", JSON.stringify(item));
      window.location.href = "ConsulatarCampo.html";
    },
  },
});

const tabelaReservas = new Vue({
  el: '#tabelaReservas',
  data: {
    items: []
  },
  mounted() {
    const data = localStorage.getItem('Reservas');
    if (data) {
      const parsedData = JSON.parse(data);
      console.log(parsedData)
      this.items = parsedData;
    }
  },
  methods: {
    verReserva(item) {
      sessionStorage.setItem("ReservaEscolhida", JSON.stringify(item));
      window.location.href = "DetalhesReservas.html";
    },
  },
});


const TabelaParcerias = new Vue({
  el: '#TabelaParcerias',
  data: {
    items: []
  },
  mounted() {
    const data = localStorage.getItem('Parcerias');
    if (data) {
      const parsedData = JSON.parse(data);
      console.log(parsedData)
      this.items = parsedData;
    }
  },
  methods: {
    verParceria(item) {
      sessionStorage.setItem("ReservaEscolhida", JSON.stringify(item));
      window.location.href = "DetalhesParceria.html";
    },
  },
});

const tabelaPagamentos = new Vue({
  el: '#tabelaPagamentos',
  data: {
    items: []
  },
  mounted() {
    const data = localStorage.getItem('Pagamentos');
    if (data) {
      const parsedData = JSON.parse(data);
      console.log(parsedData)
      this.items = parsedData;
    }
  },
});

const ConsultarPro = new Vue({
  el: '#labelsPro',
  data: {
    Nome: "",
    Naturalidade: "",
    Dob: "",
    Email: "",
    Contacto: "",
    Campo: "",
    items: []
  },
  mounted() {
    const dataCampos = localStorage.getItem('Campos');
    const data = sessionStorage.getItem('ProEscolhido');
    const quadrado = document.getElementById("quadrado-inserir-imagem_Pro");
    const dados = JSON.parse(data);
    quadrado.style.backgroundImage = dados.Imagem;
    quadrado.style.backgroundSize = 'cover';
    quadrado.style.backgroundPosition = 'center';
    quadrado.style.backgroundRepeat = 'no-repeat';
    if (dataCampos) {
      const parsedData = JSON.parse(dataCampos);
      this.items = parsedData;
    }
    this.Nome = dados.Nome;
    this.Naturalidade = dados.Naturalidade;
    this.Dob = dados.Dob;
    this.Email = dados.Email;
    this.Contacto = dados.Contacto;
    this.Campo = dados.Campo;
  }
});

const ConsultarCampo = new Vue({
  el: '#labelsCampo',
  data: {
    Nome: "",
    Localizacao: "",
    Balnearios: "",
    Relvado: "",
    Outros: "",
    Preco: "",
    Bola: "",
    Coletes: "",
  },
  mounted() {
    const user = JSON.parse(sessionStorage.getItem('UtilizadorLigado'));
    const Pros = JSON.parse(localStorage.getItem('Profissionais'));
    const inputNome = document.querySelector("#input-fundo");
    const inputlocalizacao = document.querySelector("#input-localizacao");
    const inputbalnearios = document.querySelector("#input-balnearios");
    const inputrelvado = document.querySelector("#input-relvado");
    const inputOutros = document.querySelector("#input-Outros");
    const inputPreco = document.querySelector("#input-Preco");
    const inputbola = document.querySelector("#input-bola");
    const inputcoletes = document.querySelector("#input-coletes");
    const ApagarCampo = document.querySelector("#ApagarCampo");
    const GuardarCampo = document.querySelector("#GuardarDadosCampo");
    const data = sessionStorage.getItem('CampoEscolhido');
    const quadrado = document.getElementById("quadrado-inserir-imagem");
    const dados = JSON.parse(data);
    quadrado.style.backgroundImage = dados.Imagem;
    quadrado.style.backgroundSize = 'cover';
    quadrado.style.backgroundPosition = 'center';
    quadrado.style.backgroundRepeat = 'no-repeat';
    this.Nome = dados.Nome;
    this.Localizacao = dados.Localizacao;
    this.Balnearios = dados.Balnearios;
    this.Relvado = dados.Relvado;
    this.Outros = dados.Outros;
    this.Preco = dados.Preco;
    this.Bola = dados.Bola;
    this.Coletes = dados.Coletes;

    if (user.Tipo !== "Admin") {
      var itemIndex = Pros.findIndex(item => item.Username === user.Username);
      console.log(itemIndex)
      console.log(Pros[itemIndex].Campo)
      console.log(dados.Nome)
      if (itemIndex !== -1) {
        if (Pros[itemIndex].Campo !== dados.Nome) {
          inputNome.disabled = true;
          inputlocalizacao.disabled = true;
          inputlocalizacao.disabled = true;
          inputbalnearios.disabled = true;
          inputrelvado.disabled = true;
          inputOutros.disabled = true;
          inputPreco.disabled = true;
          inputbola.disabled = true;
          inputcoletes.disabled = true;
          ApagarCampo.style.display = "none"
          GuardarCampo.style.display = "none"
        }
      }
    }
  }
});


const SelectCampos = new Vue({
  el: '#SelectCampos',
  data: {
    items: []
  },
  mounted() {
    const data = localStorage.getItem('Campos');
    if (data) {
      const parsedData = JSON.parse(data);
      this.items = parsedData;
    }
  }
});

const SelectPros = new Vue({
  el: '#muitacena',
  data: {
    items: [],
    item2: [],
    item: [],
  },
  mounted() {
    const data = localStorage.getItem('Profissionais');
    const dataCampos = JSON.parse(localStorage.getItem('Campos'));
    const data2 = JSON.parse(sessionStorage.getItem('ReservaEscolhida'));
    
    let a = [];
    if (data) {
      const parsedData = JSON.parse(data);
      for (let i = 0; i < parsedData.length; i++) {
        if (parsedData[i].Campo === data2.Campo) {
          a.push(parsedData[i])
        }
        
      }

      this.items = a;
    }
    var itemIndex = dataCampos.findIndex(item => item.Nome === data2.Campo);
    console.log(dataCampos[itemIndex].Nome) 
    this.item2 = dataCampos[itemIndex];
    this.item = data2;
  }
});

function perfil() {
  const user = JSON.parse(sessionStorage.getItem('UtilizadorLigado'));
  const reserva = JSON.parse(sessionStorage.getItem('ReservaEscolhida'));
  const aDashboard = document.querySelector("#dashboardLI");
  const selPros = document.querySelector("#SelectPros");
  const buttons = document.querySelector("#ConfReserva");
  const aParcerias = document.querySelector("#PedidosParc");
  const aPros = document.querySelector("#Pros");
  document.getElementById("NomePerf").innerHTML = user.Username;
  console.log(reserva.Estado)
  if(reserva.Estado !== "Pendente"){
    buttons.style.display = "none";
    selPros.disabled = true;
  }
  if (user.Tipo !== "Admin") {
    aDashboard.style.display = "none";
    aParcerias.style.display = "none";
    aPros.style.display = "none";
  }

}

function Marcar(x,y){
  const Profissional = document.querySelector("#SelectPros").value;
  const Reservas = JSON.parse(localStorage.getItem('Reservas'));
  const Pros = JSON.parse(localStorage.getItem('Profissionais'));
  const reserva = JSON.parse(sessionStorage.getItem('ReservaEscolhida'));
  var itemIndex = Reservas.findIndex(item => item.IdReserva === reserva.IdReserva);
  var itemIndex2 = Pros.findIndex(item => item.NIF === Profissional);
  if(x===1){
    Reservas[itemIndex].Estado = "Aprovada"
    Reservas[itemIndex].Profissional = Pros[itemIndex2].Nome
    Reservas[itemIndex].ProfissionalNIF = Profissional
    reserva.Estado = "Aprovada"
    reserva.Profissional = Pros[itemIndex2].Nome
    reserva.ProfissionalNIF = Profissional
  }else{
    Reservas[itemIndex].Estado = "Recusada"
    reserva.Estado = "Recusada"
  }

  localStorage.setItem("Reservas", JSON.stringify(Reservas))
  sessionStorage.setItem("ReservaEscolhida", JSON.stringify(reserva))
  window.location.href = "Reservas.html"
}

function AceitarParceria(){
  const Parceria = JSON.parse(sessionStorage.getItem('ParceriaEscolhida'));
  const Parcerias = JSON.parse(localStorage.getItem('Parcerias'));
  const Campos = JSON.parse(localStorage.getItem('Campos'));
  const Proprietarios = JSON.parse(localStorage.getItem('Proprietarios'));
  let data = {}
  let data2 = {}
  var itemIndex = Parcerias.findIndex(item => item.nome_campo === Parceria.nome_campo);
  if(Aceitar){
    data["Nome"].Nome = Parceria.nome_campo
    data["Imagem"].Imagem = "";
    data["Localizacao"].Localizacao = Parceria.localizacao_campo
    data["Balnearios"].Balnearios = Parceria.n_balnearios
    data["Relvado"].Relvado = Parceria.piso
    data["Outros"].Outros = ""
    data["Preco"].Preco = Parceria.preco_campo
    data["Bola"].Bola = Parceria.bola
    data["Coletes"].Coletes = Parceria.coletes

    data2["Nome"] = Parceria.nome_proprietario
    data2["NIF"] = Parceria.nif_proprietario
    data2["Naturalidade"] = Parceria.naturalidade_proprietario
    data2["Email"] = Parceria.email_proprietario
    data2["Dob"] = Parceria.data_nasc_proprietario
    data2["Contacto"] = Parceria.contacto_proprietario
    data2["Campo"] = Parceria.nome_campo

    Campos.push(data)
    Proprietarios.push(data2)
    Parcerias.splice(itemIndex, 1);
    localStorage.setItem('Parcerias', JSON.stringify(Parcerias));

    localStorage.setItem("Campos", JSON.stringify(Campos))
    localStorage.setItem("Proprietarios", JSON.stringify(Proprietarios))
  }else{
    var itemIndex = Parcerias.findIndex(item => item.nome_campo === Parceria.nome_campo);
    Parcerias.splice(itemIndex, 1);
    localStorage.setItem('Parcerias', JSON.stringify(Parcerias));
  }
}